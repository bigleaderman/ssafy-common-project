{"ast":null,"code":"var _jsxFileName = \"C:\\\\SSAFY\\\\2nd semester\\\\S07P12D106\\\\front\\\\src\\\\components\\\\Friends.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Table, TableContainer, TableBody, Paper, TableRow, TableCell, Button } from \"@mui/material\";\nimport { friendList } from \"../redux/slice/FriendListSlice\";\nimport SockJS from \"sockjs-client\";\nimport { over } from \"stompjs\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar stompClient = null;\n\nfunction Friends() {\n  _s();\n\n  const dispatch = useDispatch();\n  const me = useSelector(state => state.user);\n  const friendLists = useSelector(state => state.friendList); // 친구 관련\n\n  const [friend, setFriend] = useState(friendLists); // 친구 목록\n\n  const [wantFriend, setWantFriend] = useState([]); // 나에게 친구 신청한 목록\n\n  useEffect(() => {\n    // 친구 신청 목록\n    axios.get(\"/api/user/friend/request-list\", {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${me.accessToken}`\n      }\n    }).then(response => {\n      setWantFriend(response.data);\n    });\n    connect();\n    return () => {\n      stompClient.disconnect();\n    };\n  }, []); // 소켓 연결\n\n  const connect = () => {\n    let Sock = new SockJS(\"https://i7d106.p.ssafy.io:8080/ws\");\n    stompClient = over(Sock);\n    stompClient.connect({}, onConnected, onError);\n  }; // 구독 연결\n\n\n  const onConnected = () => {\n    stompClient.subscribe(`/sub/friend/${me.nickname}`, Received);\n  };\n\n  const onError = err => {\n    console.log(\"친구 소켓 연결 실패\", err);\n  }; // 소켓으로부터 받기\n\n\n  const Received = payload => {\n    var payloadData = JSON.parse(payload.body);\n\n    if (payloadData.header.type === \"list\") {\n      // 친구목록\n      setFriend(payloadData.friendResponseDataDto.users);\n      dispatch(friendList(payloadData.friendResponseDataDto.users));\n    } else {\n      if (payloadData.header.type === \"offer-list\") {\n        // 나에게 친구 신청한 목록\n        setWantFriend(payloadData.friendResponseDataDto.users);\n      }\n    }\n  }; // 서버로 전송하기 (친구 수락, 친구 거절, 친구 삭제)\n\n\n  const SendF = (f, type) => {\n    if (stompClient.ws.readyState === 1) {\n      // 연결이 되었을 때 전송해야함\n      var sendData = {\n        header: {\n          type\n        },\n        data: {\n          friendSeq: f.friendSeq,\n          from: me.nickname,\n          to: f.nickname\n        }\n      };\n      return stompClient.send(`/pub/friend/${f.nickname}`, {}, JSON.stringify(sendData));\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    children: /*#__PURE__*/_jsxDEV(TableContainer, {\n      style: {\n        padding: \"20px\",\n        height: \"100px\"\n      },\n      component: Paper,\n      children: /*#__PURE__*/_jsxDEV(Table, {\n        size: \"medium\",\n        children: /*#__PURE__*/_jsxDEV(TableBody, {\n          children: [\"\\uB098\\uC5D0\\uAC8C \\uC2E0\\uCCAD\\uD55C \\uCE5C\\uAD6C \\uBAA9\\uB85D\", wantFriend && wantFriend.map((wantF, index) => /*#__PURE__*/_jsxDEV(TableRow, {\n            children: /*#__PURE__*/_jsxDEV(TableCell, {\n              children: [wantF.nickname, /*#__PURE__*/_jsxDEV(Button, {\n                onClick: () => {\n                  SendF(wantF, \"offer-accept\");\n                },\n                children: \"O\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 101,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                onClick: () => {\n                  SendF(wantF, \"offer-deny\");\n                },\n                children: \"X\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 108,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 99,\n              columnNumber: 19\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 17\n          }, this)), \"\\uCE5C\\uAD6C \\uBAA9\\uB85D\", friend && friend.map((f, index) => /*#__PURE__*/_jsxDEV(TableRow, {\n            children: /*#__PURE__*/_jsxDEV(TableCell, {\n              children: [f.nickname, /*#__PURE__*/_jsxDEV(Button, {\n                onClick: () => {\n                  SendF(f, \"delete\");\n                },\n                children: \"DEL\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 124,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 122,\n              columnNumber: 19\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 17\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Friends, \"WGmXFmxYGxsepdtZ4A1aIz5DRw8=\", false, function () {\n  return [useDispatch, useSelector, useSelector];\n});\n\n_c = Friends;\nexport default Friends;\n\nvar _c;\n\n$RefreshReg$(_c, \"Friends\");","map":{"version":3,"names":["React","useEffect","useState","axios","useSelector","useDispatch","Table","TableContainer","TableBody","Paper","TableRow","TableCell","Button","friendList","SockJS","over","stompClient","Friends","dispatch","me","state","user","friendLists","friend","setFriend","wantFriend","setWantFriend","get","headers","Authorization","accessToken","then","response","data","connect","disconnect","Sock","onConnected","onError","subscribe","nickname","Received","err","console","log","payload","payloadData","JSON","parse","body","header","type","friendResponseDataDto","users","SendF","f","ws","readyState","sendData","friendSeq","from","to","send","stringify","padding","height","map","wantF","index"],"sources":["C:/SSAFY/2nd semester/S07P12D106/front/src/components/Friends.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport {\r\n  Table,\r\n  TableContainer,\r\n  TableBody,\r\n  Paper,\r\n  TableRow,\r\n  TableCell,\r\n  Button,\r\n} from \"@mui/material\";\r\nimport { friendList } from \"../redux/slice/FriendListSlice\";\r\n\r\nimport SockJS from \"sockjs-client\";\r\nimport { over } from \"stompjs\";\r\n\r\nvar stompClient = null;\r\nfunction Friends() {\r\n  \r\n  const dispatch = useDispatch();\r\n  const me = useSelector((state) => state.user);\r\n  const friendLists = useSelector((state) => state.friendList);\r\n  // 친구 관련\r\n  const [friend, setFriend] = useState(friendLists); // 친구 목록\r\n  const [wantFriend, setWantFriend] = useState([]); // 나에게 친구 신청한 목록\r\n  useEffect(() => {\r\n    // 친구 신청 목록\r\n    axios\r\n      .get(\"/api/user/friend/request-list\", {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${me.accessToken}`,\r\n        },\r\n      })\r\n      .then((response) => {\r\n        setWantFriend(response.data);\r\n      });\r\n    connect();\r\n    return () => {\r\n      stompClient.disconnect()\r\n    }\r\n  }, []);\r\n  // 소켓 연결\r\n  const connect = () => {\r\n    let Sock = new SockJS(\"https://i7d106.p.ssafy.io:8080/ws\");\r\n    stompClient = over(Sock);\r\n    stompClient.connect({}, onConnected, onError);\r\n  };\r\n  // 구독 연결\r\n  const onConnected = () => {\r\n    stompClient.subscribe(`/sub/friend/${me.nickname}`, Received);\r\n  };\r\n  const onError = (err) => {\r\n    console.log(\"친구 소켓 연결 실패\", err);\r\n  };\r\n\r\n  // 소켓으로부터 받기\r\n  const Received = (payload) => {\r\n    var payloadData = JSON.parse(payload.body);\r\n    if (payloadData.header.type === \"list\") {\r\n      // 친구목록\r\n      setFriend(payloadData.friendResponseDataDto.users);\r\n      dispatch(friendList(payloadData.friendResponseDataDto.users));\r\n    } else {\r\n      if (payloadData.header.type === \"offer-list\") {\r\n        // 나에게 친구 신청한 목록\r\n        setWantFriend(payloadData.friendResponseDataDto.users);\r\n      }\r\n    }\r\n  };\r\n\r\n  // 서버로 전송하기 (친구 수락, 친구 거절, 친구 삭제)\r\n  const SendF = (f, type) => {\r\n    if (stompClient.ws.readyState === 1) {\r\n      // 연결이 되었을 때 전송해야함\r\n      var sendData = {\r\n        header: {\r\n          type,\r\n        },\r\n        data: {\r\n          friendSeq: f.friendSeq,\r\n          from: me.nickname,\r\n          to: f.nickname,\r\n        },\r\n      };\r\n      return stompClient.send(`/pub/friend/${f.nickname}`, {}, JSON.stringify(sendData));\r\n    }\r\n  };\r\n  return (\r\n    <span>\r\n      <TableContainer style={{ padding: \"20px\", height: \"100px\" }} component={Paper}>\r\n        <Table size='medium'>\r\n          <TableBody>\r\n            나에게 신청한 친구 목록\r\n            {wantFriend &&\r\n              wantFriend.map((wantF, index) => (\r\n                <TableRow key={index}>\r\n                  <TableCell>\r\n                    {wantF.nickname}\r\n                    <Button\r\n                      onClick={() => {\r\n                        SendF(wantF, \"offer-accept\");\r\n                      }}\r\n                    >\r\n                      O\r\n                    </Button>\r\n                    <Button\r\n                      onClick={() => {\r\n                        SendF(wantF, \"offer-deny\");\r\n                      }}\r\n                    >\r\n                      X\r\n                    </Button>\r\n                  </TableCell>\r\n                </TableRow>\r\n              ))}\r\n            친구 목록\r\n            {friend &&\r\n              friend.map((f, index) => (\r\n                <TableRow key={index}>\r\n                  <TableCell>\r\n                    {f.nickname}\r\n                    <Button\r\n                      onClick={() => {\r\n                        SendF(f, \"delete\");\r\n                      }}\r\n                    >\r\n                      DEL\r\n                    </Button>\r\n                  </TableCell>\r\n                </TableRow>\r\n              ))}\r\n          </TableBody>\r\n        </Table>\r\n      </TableContainer>\r\n    </span>\r\n  );\r\n}\r\nexport default Friends;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}