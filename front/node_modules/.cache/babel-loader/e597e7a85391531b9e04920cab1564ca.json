{"ast":null,"code":"var WildEmitter = require('wildemitter');\n\nfunction getMaxVolume(analyser, fftBins) {\n  var maxVolume = -Infinity;\n  analyser.getFloatFrequencyData(fftBins);\n\n  for (var i = 4, ii = fftBins.length; i < ii; i++) {\n    if (fftBins[i] > maxVolume && fftBins[i] < 0) {\n      maxVolume = fftBins[i];\n    }\n  }\n\n  ;\n  return maxVolume;\n}\n\nvar audioContextType;\n\nif (typeof window !== 'undefined') {\n  audioContextType = window.AudioContext || window.webkitAudioContext;\n} // use a single audio context due to hardware limits\n\n\nvar audioContext = null;\n\nmodule.exports = function (stream, options) {\n  var harker = new WildEmitter(); // make it not break in non-supported browsers\n\n  if (!audioContextType) return harker; //Config\n\n  var options = options || {},\n      smoothing = options.smoothing || 0.1,\n      interval = options.interval || 50,\n      threshold = options.threshold,\n      play = options.play,\n      history = options.history || 10,\n      running = true; // Ensure that just a single AudioContext is internally created\n\n  audioContext = options.audioContext || audioContext || new audioContextType();\n  var sourceNode, fftBins, analyser;\n  analyser = audioContext.createAnalyser();\n  analyser.fftSize = 512;\n  analyser.smoothingTimeConstant = smoothing;\n  fftBins = new Float32Array(analyser.frequencyBinCount);\n  if (stream.jquery) stream = stream[0];\n\n  if (stream instanceof HTMLAudioElement || stream instanceof HTMLVideoElement) {\n    //Audio Tag\n    sourceNode = audioContext.createMediaElementSource(stream);\n    if (typeof play === 'undefined') play = true;\n    threshold = threshold || -50;\n  } else {\n    //WebRTC Stream\n    sourceNode = audioContext.createMediaStreamSource(stream);\n    threshold = threshold || -50;\n  }\n\n  sourceNode.connect(analyser);\n  if (play) analyser.connect(audioContext.destination);\n  harker.speaking = false;\n\n  harker.suspend = function () {\n    return audioContext.suspend();\n  };\n\n  harker.resume = function () {\n    return audioContext.resume();\n  };\n\n  Object.defineProperty(harker, 'state', {\n    get: function () {\n      return audioContext.state;\n    }\n  });\n\n  audioContext.onstatechange = function () {\n    harker.emit('state_change', audioContext.state);\n  };\n\n  harker.setThreshold = function (t) {\n    threshold = t;\n  };\n\n  harker.setInterval = function (i) {\n    interval = i;\n  };\n\n  harker.stop = function () {\n    running = false;\n    harker.emit('volume_change', -100, threshold);\n\n    if (harker.speaking) {\n      harker.speaking = false;\n      harker.emit('stopped_speaking');\n    }\n\n    analyser.disconnect();\n    sourceNode.disconnect();\n  };\n\n  harker.speakingHistory = [];\n\n  for (var i = 0; i < history; i++) {\n    harker.speakingHistory.push(0);\n  } // Poll the analyser node to determine if speaking\n  // and emit events if changed\n\n\n  var looper = function () {\n    setTimeout(function () {\n      //check if stop has been called\n      if (!running) {\n        return;\n      }\n\n      var currentVolume = getMaxVolume(analyser, fftBins);\n      harker.emit('volume_change', currentVolume, threshold);\n      var history = 0;\n\n      if (currentVolume > threshold && !harker.speaking) {\n        // trigger quickly, short history\n        for (var i = harker.speakingHistory.length - 3; i < harker.speakingHistory.length; i++) {\n          history += harker.speakingHistory[i];\n        }\n\n        if (history >= 2) {\n          harker.speaking = true;\n          harker.emit('speaking');\n        }\n      } else if (currentVolume < threshold && harker.speaking) {\n        for (var i = 0; i < harker.speakingHistory.length; i++) {\n          history += harker.speakingHistory[i];\n        }\n\n        if (history == 0) {\n          harker.speaking = false;\n          harker.emit('stopped_speaking');\n        }\n      }\n\n      harker.speakingHistory.shift();\n      harker.speakingHistory.push(0 + (currentVolume > threshold));\n      looper();\n    }, interval);\n  };\n\n  looper();\n  return harker;\n};","map":{"version":3,"names":["WildEmitter","require","getMaxVolume","analyser","fftBins","maxVolume","Infinity","getFloatFrequencyData","i","ii","length","audioContextType","window","AudioContext","webkitAudioContext","audioContext","module","exports","stream","options","harker","smoothing","interval","threshold","play","history","running","sourceNode","createAnalyser","fftSize","smoothingTimeConstant","Float32Array","frequencyBinCount","jquery","HTMLAudioElement","HTMLVideoElement","createMediaElementSource","createMediaStreamSource","connect","destination","speaking","suspend","resume","Object","defineProperty","get","state","onstatechange","emit","setThreshold","t","setInterval","stop","disconnect","speakingHistory","push","looper","setTimeout","currentVolume","shift"],"sources":["C:/SSAFY/2nd semester/S07P12D106/front/node_modules/hark/hark.js"],"sourcesContent":["var WildEmitter = require('wildemitter');\n\nfunction getMaxVolume (analyser, fftBins) {\n  var maxVolume = -Infinity;\n  analyser.getFloatFrequencyData(fftBins);\n\n  for(var i=4, ii=fftBins.length; i < ii; i++) {\n    if (fftBins[i] > maxVolume && fftBins[i] < 0) {\n      maxVolume = fftBins[i];\n    }\n  };\n\n  return maxVolume;\n}\n\n\nvar audioContextType;\nif (typeof window !== 'undefined') {\n  audioContextType = window.AudioContext || window.webkitAudioContext;\n}\n// use a single audio context due to hardware limits\nvar audioContext = null;\nmodule.exports = function(stream, options) {\n  var harker = new WildEmitter();\n\n  // make it not break in non-supported browsers\n  if (!audioContextType) return harker;\n\n  //Config\n  var options = options || {},\n      smoothing = (options.smoothing || 0.1),\n      interval = (options.interval || 50),\n      threshold = options.threshold,\n      play = options.play,\n      history = options.history || 10,\n      running = true;\n\n  // Ensure that just a single AudioContext is internally created\n  audioContext = options.audioContext || audioContext || new audioContextType();\n\n  var sourceNode, fftBins, analyser;\n\n  analyser = audioContext.createAnalyser();\n  analyser.fftSize = 512;\n  analyser.smoothingTimeConstant = smoothing;\n  fftBins = new Float32Array(analyser.frequencyBinCount);\n\n  if (stream.jquery) stream = stream[0];\n  if (stream instanceof HTMLAudioElement || stream instanceof HTMLVideoElement) {\n    //Audio Tag\n    sourceNode = audioContext.createMediaElementSource(stream);\n    if (typeof play === 'undefined') play = true;\n    threshold = threshold || -50;\n  } else {\n    //WebRTC Stream\n    sourceNode = audioContext.createMediaStreamSource(stream);\n    threshold = threshold || -50;\n  }\n\n  sourceNode.connect(analyser);\n  if (play) analyser.connect(audioContext.destination);\n\n  harker.speaking = false;\n\n  harker.suspend = function() {\n    return audioContext.suspend();\n  }\n  harker.resume = function() {\n    return audioContext.resume();\n  }\n  Object.defineProperty(harker, 'state', { get: function() {\n    return audioContext.state;\n  }});\n  audioContext.onstatechange = function() {\n    harker.emit('state_change', audioContext.state);\n  }\n\n  harker.setThreshold = function(t) {\n    threshold = t;\n  };\n\n  harker.setInterval = function(i) {\n    interval = i;\n  };\n\n  harker.stop = function() {\n    running = false;\n    harker.emit('volume_change', -100, threshold);\n    if (harker.speaking) {\n      harker.speaking = false;\n      harker.emit('stopped_speaking');\n    }\n    analyser.disconnect();\n    sourceNode.disconnect();\n  };\n  harker.speakingHistory = [];\n  for (var i = 0; i < history; i++) {\n      harker.speakingHistory.push(0);\n  }\n\n  // Poll the analyser node to determine if speaking\n  // and emit events if changed\n  var looper = function() {\n    setTimeout(function() {\n\n      //check if stop has been called\n      if(!running) {\n        return;\n      }\n\n      var currentVolume = getMaxVolume(analyser, fftBins);\n\n      harker.emit('volume_change', currentVolume, threshold);\n\n      var history = 0;\n      if (currentVolume > threshold && !harker.speaking) {\n        // trigger quickly, short history\n        for (var i = harker.speakingHistory.length - 3; i < harker.speakingHistory.length; i++) {\n          history += harker.speakingHistory[i];\n        }\n        if (history >= 2) {\n          harker.speaking = true;\n          harker.emit('speaking');\n        }\n      } else if (currentVolume < threshold && harker.speaking) {\n        for (var i = 0; i < harker.speakingHistory.length; i++) {\n          history += harker.speakingHistory[i];\n        }\n        if (history == 0) {\n          harker.speaking = false;\n          harker.emit('stopped_speaking');\n        }\n      }\n      harker.speakingHistory.shift();\n      harker.speakingHistory.push(0 + (currentVolume > threshold));\n\n      looper();\n    }, interval);\n  };\n  looper();\n\n  return harker;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}